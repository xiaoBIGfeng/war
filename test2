def add_module_prefix(state_dict):
    """
    为普通模型的 state_dict 添加 `module.` 前缀，以适配 DDP 模型
    """
    new_state_dict = {}
    for key, value in state_dict.items():
        new_state_dict[f"module.{key}"] = value  # 添加 `module.` 前缀
    return new_state_dict

# 加载普通模型的权重
checkpoint = torch.load(model_path, map_location=device)

# 为权重添加 `module.` 前缀
state_dict = add_module_prefix(checkpoint)

# 加载到 DDP 模型中
model.load_state_dict(state_dict, strict=True)
